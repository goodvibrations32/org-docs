#+TITLE: Filtering sensor signal from environmental EMI using Digital Signal Processing methods with a case study application.
#+AUTHOR: Nickolas Torosian
#+AUTHOR: Nikos Papadakis
#+LANGUAGE: gr
#+startup: latexpreview
#+PROPERTY: header-args:latex-as-png :results raw value replace



* The signal theory

** Εισαγωγή

Σε πολλές περιπτώσεις η ανάγκη της επεξεργασίας σημάτων, όπως στις
τηλεπικοινωνίες μετά ή/και πριν την μετάδοση από τον πομπό προς τον
δέκτη, και η εκλογή πληροφοριών από αυτό έθεσαν από νωρίς το πρόβλημα
των παρεμβολών του περιβάλλοντος στις ηλεκτρονικές συσκευές και την
ανάγκη απομόνωσης του φάσματος των συχνοτήτων που χρησιμοποιούνται για
κάθε λειτουργία.

Η απομόνωση αυτή μπορεί να επιτευχθεί είτε μέσω συμβατικών φιλτρών,
δηλαδή αντιστάσεις και πυκνωτές κατάλληλα τοποθετημένους στο κύκλωμα που
συλλέγει την τάση (ρεύμα μέτρησης), είτε με την χρήση μεθόδων ψηφιακής
επεξεργασίας σημάτων (ΔΣΠ). Στις μέρες μας προτιμάται ο 2ος τρόπος λόγω
της ραγδαίας εξέλιξης των Η/Υ με αποτέλεσμα να επιφέρει μεγαλύτερο
κόστος η εγκατάσταση αναλογικών φίλτρων σε κάθε θέση που απαιτείται.

Οι μέθοδοι αλλά και η πληθώρα συστημάτων λήψης και ανάλησης σημάτων τις
τελευταίες δεκαετίες έχουν, αφενός εξελιχθεί ως προς την υπολογιστική
ισχή με γρηγορότερους επεξεργαστές και αλγόριθμους, αφεταίρου δίνουν
πλέον την δυνατότητα δαχείρισης των πληροφοριών απομακρισμένα με
αποτέλεσμα την ευρύτερη εγκαθίδριση των ψηφιακών μέσων επεξεργασίας
σημάτων. Στις μέρες μας η ανάγκη διαχείρησης ολοένα και μεγαλύτερα
αρχεία δεδομένων με καλύτερη ακρίβεια οδήγησε την επιστημονική κοινότητα
στην χρήση της μεθόδου *μετα-επεξεργασίας* (post-processing). Βασικό όφελος
ήταν η δυνατότητα επαναλληψιμότητας του πειράματος και σύγκρισης των
αποτελεσμάτων σε όλο τον κόσμο, ουσιαστική αρχή της πειραματικής
διαδικασίας. Έτσι με την χρήση προγραμματισμού δίνεται πλέον η
δυνατότητα στον ερευνητή, να δημιουργεί ενα περιβάλλον προσομοίωσης και
να δοκιμάζει διάφορες λύσεις χωρίς να επισκευτεί την πειραματική διάταξη
σε πολλές περιπτώσεις μετά την καταγραφή των μετρήσεων.

Στην παρούσα εργασία θα πραγματευτούμε την απομείωση συγκεκριμένων
συχνοτήτων με την χρήση Ψηφιακής Ανάλησης Σημάτων και φίλτρων, διαφόρων
κατηγοριών. _Στο πλαισιο αυτό θα παρουσιαστεί, μια μελέτη που
πραγματοποιήθηκε σε συνεργασία με το εργαστήριο Αιολικής Ενέργειας του
τμήματος Μηχανολόγων Μηχανικών στο Ελληνικό Μεσογειακό Πανεπιστήμιο με
θέμα ….._ Η ιδιαιτερότητα που παρουσιάστηκε στην εγκατάσταση ήταν
παρεμβολές από ηλεκτρικό μετασχηματιστή, που όμως ήταν αδύνατο να
αφαιρεθεί, και ταυτόχρονα ο σχεδιασμός οπώς και η τοποθέτηση ενός
αναλογικού φίλτρου θα ενέτασαν μεγάλο κόστος και περιπλοκότητα. Θα
αναλήθουν οι δομές σημάτων που επεξεργάστηκαν καθώς και οι τύποι των
φίλτρων που χρησίμευσαν στην απομόνωση των ζητούμενων σημάτων. Επίσης θα
υπάρξει παράθεση των θετικών και αρνητικών που παρατηρήθηκαν κατά την
διάρκεια εκτέλεσης της επεξεργασίας και καταγραφής των δεδομένων (τυποι
αρχείων δεδομένων). Τέλος θα ήθελα να ευχαριστήσω τον καθηγητή μου κ.
Νίκο Παπαδάκη για την καθοδήγησή του και την υπομονή που έδειξε για τις
λιγοστές γνωσεις μου στον προγρμματισμό.


+ Here should be a general intro for the signal processing and some idea for the stuff that will follow. Also I should mention a broad field for the applications and the cost effect on projects that are already in use and how we could implement a vital solution without rebuilding.
** Ιστορική αναδρομή Historical perspective (Istoriki anadromi)
From the book *discrete_domain_signal.pdf*
** Επεξεργασία σημάτων (Signal process (post-processing))

*** Ορισμός μετα-επεξεργασίας
Η επεξεργασία ενός σήματος θα πρέπει να γίνεται με προσοχή καθώς είναι
εύκολο να καταστραφεί μέρος της πληροφορίας που περιέχεται ή ακόμα και
να εκδοθούν λανθασμένα συμπεράσματα για την συμπεριφορά του συστήματος.
Εδώ χρησιμοποιηθηκε η *μετα-επεξεργασία* (post-process), δηλαδή τα δεδομένα
καταγράφηκαν με σταθερή συχνότητα δειγματοληψίας σε μορφή αρχείου
δεδομένων (datasets) .tdms μέσω του προγράμματος LabView.

Η μέθοδος αυτή δίνει την δυνατότητα στον αναλυτή να επεξεργαστεί τα
δεδομένα στον προσωπικό του υπολογιστή ακόμα και να συνδεθεί σε κάποιον
ισχυρότερο υπολογιστή και να τα διαχειριστεί εξ’ αποστάσεως. Μπορεί όμως
να γίνεται και στην εγκατάσταστη αυτοματοποιόντας την διαδικασία
καταγραφής των δεδομένων. Τα συστήματα τηλεπικοινονιών βασίζονται στην
σωστή κωικοποίηση από τον πομπό και αποκωδικοποίηση στον δέκτη, οι
διαδικασίες αυτές λαμβάνουν χώρα στις συσκευές που καταγράφουν και
μεταδίδουν το σήμα, όμως επειδή η επεξεργασία της
κωδικοποίησης-αποκωδικοποίησης γίνεται αφού καταγραφεί το σήμα σε κάποια
προσωρινή ή μόνιμη μνήμη και έτσι εντάσεται στην *μετα-επεξεργασία*.

*** Εγκατάσταση εργαστηρίου
Η εγκατάσταση που χρησιμοποποιήθηκε για την συλλογη των δεδομένων
αποτελείται από μία αεροσύραγγα την οποία τροφοδοτεί με σταθερή ταχύτητα
αέρα ενας ηλεκτροκινητήρας προσδεδεμένος σε έναν έλικα. Στην μέση της
σύραγγας υπάρχει ένα πλέγμα διάχυσης ώστε η ροή του αέρα να γίνεται όσο
το δυνατόν πιο ομοιόμορφα στην έξοδο όπου βρίσκεται και το αισθητήριο
όργανο για την καταγραφή της ταχύτητας του ανέμου. Παρακάτω φαίνεται μια
εικόνα της εγκατάστασης σε σχηματικό διάγραμμα.
[[file:~/Pictures/Wind_Tunnel_setup_lab.png]]


Ένας λόγος που δεν χρησιμοποιήθηκε επεξεργασία σε πραγματικό χρόνο είναι
οτι η εγκατάσταση που χρησιμοποιήθηκε για την συλλογη των δεδομένων
κατασκευάστηκε με σκοπό την σύνδεσή του σε κεντρική μονάδα επικοινωνίας
και από εκεί πραγματοποιείται σύνδεση μέσω σειριακής θύρας USB με Η/Υ,
όπου και καταγράφεται το σήμα του αισθητήριου οργάνου (pitot-tube). Ένας
δεύτερος λόγος ήταν η ανάγκη να δοκιμαστούν διαφορετικές μέθοδοι
αφαίρεσης του θορύβου και προφανώς αυτό θα ήταν πιο δύσκολο εάν έπρεπε
να γίνει σε πραγματικό χρόνο αλλάζοντας τις απαραίτητες παραμέτρους για
την ρύθμιση του φίλτρου. Θα έπρεπε λοιπόν να εγκατασταθεί άναλογη
συσκεύη, όπως ένας μικροεπεξεργαστής, που θα είχε την δυνατότητα για
υψηλές ταχύτητες δειγματολειψίας καθώς η καταγραφή έγινε στα 100 kHz.
Αυτό θα αύξανε πολύ το κόστος της κατασκευής και θα απαιτούσαι
βαθμονόμιση του φίλτρου για να μην προστεθεί περαιτέρω σφάλμα στην
μέτρηση


** Σήματα συνεχούς χρόνου (Continuous time signals)
*** Γενικός ορισμός
    Σήμα συνεχούς χρόνου ονομάζεται ενα σήμα x(t), το οποίο ορίζεται για
κάθε τιμή του t σε κάποιο διάστημα χρόνου [α,β]. Σύνηθως τα συναντούμε
στην μορφή συνεχούς ρεύματος σε μετρητικές και άλλες συσκευές σε εξόδους
για την ένδιξη κάποιας τιμής ή απεικόνιση σε παλμογράφο. Τα σήματα
συνεχούς χρόνου χωρίζονται σε αναλογικά και διακριτά σήματα συνεχούς
χρόνου.

*** Αναλογικό και διακριτό σήμα συνεχούς χρόνου
    Αναλογικά σήματα ονομάζονται εκείνα που η ανεξάρτητη μεταβλητή του
χρόνου (t) και η μεταβλητή του πλάτους (εξαρτημένη μεταβλητή ως προς τον
χρόνο) λαμβάνουν συνεχής και πραγματικές τιμές, π.χ. y(t) = 12 * t.
Διακριτά σήματα συνεχούς χρόνου ονομάζονται όσα ή εξαρτημένη τιμή
(πλάτος) παίρνει διακριτές τιμές, π.χ. ψ(t) = Α * t, όπου Α = 0, … ,ν
και t = [α,β] (συνεχές διάστημα χρόνου).



** TODO Σήματα διακριτού χρόνου (να δω ακριβώς την μεταφραση)
Σήμα διακριτού χρόνου ονομάζεται μια ακολουθία αριθμών καταγεγραμμένες
ανά συγκεκριμένο χρονικό διάστημα, π.χ. κάθε 0,01 δευτερόλεπτο. Το
διάστημα αυτό ορίζει την ταχύτητα καταγραφής του σήματος από την
εκάστοτε συσκευή, όμως έμεις αναφερόμαστε σε αυτό το χρόνο μέσω της
συχνότητας καταγραφής ή αλλίως σαμπλινγ φρικ. Η συχνότητα αυτή ορίζεται
ώς το πηλίκο ενός δευτερολέπτου ώς πρός το χρονικό διάστημα καταγραφής,
δηλαδή από το παραπάνω παράδειγμα θα είχαμε μια συχνότητα καταγραφής
\\begin{equation} $fs = \frac{1}{0,01}$ \\end{equation} .

Σημαντικό είναι να αναφερθεί ότι υπάρχει ένα όριο το οποίο πρέπει να
τηρείται ώστε η επαναδημιουργία του σήματος να απεικονίζει όσο το
δυνατόν πιο πολύ στο συνεχές σήμα που καταγράφηκε στην αρχή. Θα
αναφερθούμε αργότερα στο εν λόγω θεώρημα του φυσικού Νικουιστ?!

Στην κατηγορία αυτή κατατάσονται τα περισσότερα σήματα που
χρησιμοποιούνται σημερα λόγω της χρήσης Η/Υ για την καταγραφή και
παραγωγή ήχου και εικόνας. Η ένταξη των ψηφιακών σημάτων επιτάχυνε την
επεξεργασία και μείωσε δραστικά τον χώρο αποθήκευσης στην μνήμη των
υπολογιστών.

** Sampling theory
*** Niquist frequency
The Sampling frequency should be at least 2.2 times the capturing frequency.
reference : https://en.wikipedia.org/wiki/Nyquist_frequency


*** +Allan variance+
- [X] This should not be added was for papadaki in the other project.
It is a measure of frequency stability for oscillators and atomic clocks.
reference : https://en.wikipedia.org/wiki/Allan_variance

Use full example in python for noisy signals : https://towardsdatascience.com/allan-variance-in-python-d1175e5aeee2


*** Decimation and down-sampling
This technique is used when a lot of data points where provided but the overall standard deviation of the signal is giving away an periodic cycle and could be related with a vibration. Then the signal could be separated to smaller `chunks` for faster analysis.


In digital signal processing, down-sampling, compression, and decimation are terms associated with the process of resampling in a
multi-rate digital signal processing system. Both down-sampling and decimation can be synonymous with compression, or they can describe
an entire process of bandwidth reduction (filtering) and sample-rate reduction.[1][2] When the process is performed on a sequence of
samples of a signal or a continuous function, it produces an approximation of the sequence that would have been obtained by sampling the
signal at a lower rate (or density, as in the case of a photograph).

Reference
- [[https://en.wikipedia.org/wiki/Downsampling_(signal_processing)][wikipedia]]



*** Multi rate Digital signal processing
In many areas of digital signal processing (Digital Signal Processing) _applications—such as communications, speech, and audio processing—rising or lowering of a sampling rate is required_.
/The principle that deals with changing the sampling rate belongs essentially to multi-rate signal processing/
(Ifeachor and Jervis, 2002; Porat, 1997; Proakis and Manolakis, 1996; Sorensen and Chen, 1997).
As an introduction, we will focus on sampling rate conversion; that is, sampling rate reduction or increase.

[[https://www.eetimes.com/multirate-dsp-part-1-upsampling-and-downsampling/][reference]]

**** Sampling rate reduction by an integer factor
:PROPERTIES:
:TAGS_ALL: last doc
:END:
This process is referred as *down-sampling of data sequence*. This produces an aliasing effect in the signal which should be avoided.


*** Aliasing
In signal processing and related disciplines, aliasing is an effect that causes different signals to become indistinguishable (or aliases of one another) when sampled.
It also often refers to the distortion or artifact that results when a signal reconstructed from samples is different from the original continuous signal.

Aliasing can occur in signals sampled in time, for instance [[https://en.wikipedia.org/wiki/Digital_audio][digital audio]], or the stroboscopic effect, and is referred to as temporal aliasing. It can also occur in spatially sampled signals
(e.g. moiré patterns in digital images); this type of aliasing is called spatial aliasing.

Aliasing is generally avoided by applying low-pass filters or anti-aliasing filters ([[https://en.wikipedia.org/wiki/Anti-aliasing_filter][AAF]]) to the input signal before sampling and when converting a signal from a higher to a lower sampling rate.
Suitable [[https://en.wikipedia.org/wiki/Aliasing][reconstruction filtering]] should then be used when restoring the sampled signal to the continuous domain or converting a signal from a lower to a higher sampling rate.

For [[https://en.wikipedia.org/wiki/Spatial_anti-aliasing][spatial-anti-aliasing]], the types of anti-aliasing include:
 1. [[https://en.wikipedia.org/wiki/Fast_approximate_anti-aliasing][fast sample anti-aliasing (FSAA)]],
    - Description
      Fast approximate anti-aliasing (FXAA) is a screen-space anti-aliasing algorithm created by Timothy Lottes at Nvidia.
      FXAA 3 is released under a public domain license. A later version, FXAA 3.11, is released under a 3-clause BSD license.

    - [[https://en.wikipedia.org/wiki/Fast_approximate_anti-aliasing][Algorithm description and more]]

 2. [[https://en.wikipedia.org/wiki/Multisample_anti-aliasing][multisample anti-aliasing]],
    - Description
 3. [[https://en.wikipedia.org/wiki/Supersampling][supersampling]]


**** The solution to the problem
They propose an FIR low-pass filter for rejecting the unwanted frequencies.
<<

- To verify this principle, let us consider a signal x (n ) generated by the following:

  x (n ) = 5 sin ((2π × 1000n )/8000) + cos ((2π × 2500n )/8000), (12.8)

  with a sampling rate of f s = 8,000 Hz, the spectrum of x (n ) is plotted in the first graph in Figure 12-3a, where we observe that the signal has components at frequencies of 1,000 and 2,500 Hz.

    Now we down-sample x (n ) by a factor of 2, that is, M = 2. According to Equation (12.3), we know that the new folding frequency is 4000/2 = 2000 Hz.
    Hence, without using the anti-aliasing low-pass filter, the spectrum would contain the aliasing frequency of 4 kHz – 2.5 kHz = 1.5 kHz introduced by 2.5 kHz, plotted in the second graph
    in Figure 12-3a.
>>

[[~/Documents/dissertation/org-docs/dissertation document/aliasing_from_downsampling.png]]


*** [[file:~/Downloads/descrete domain signal book.pdf][Discrete fast Fourier transform ttransformransform]]
**** Parseval's theorem
The function
#+begin_latex
\|X(e^(jω))|^2
#+end_latex

is called energy density spectrum, since it determines how the energy density is distributed in the frequency domain.

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::86]]

*** Discrete Time process of continuous time signal

**** Basics

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::189]]

***** Changing the sampling rate
****** using discrete time processing

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::193]]

****** by an integer

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::193]]

****** by a non integer

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::202]]

***** Multi-rate signal processing

****** Basics

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::205]]

*** Structures for discrete signals

**** Intro

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::366]]

**** basic structures for Infinite Impulse Response systems

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::380]]


***** Feedback in Infinite Impulse Response

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::387]]

**** Basic network structures for FIR systems.

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::392]]


** Filter design

*** Intro
[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::465
]]
*** D.T. Infinite Impulse Response from C.T. filters

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::468]]

*** FIR by WINDOWING

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::491]]

**** Common windows used
- Some basic properties for:
  - Rectangle
  - Barlett
  - Hanning
  - Hamming
[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::494
]]

**** Kaiser window method

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::500]]


**** Optimum approximations of FIR

- Here is a deep analysis for the appropriate implementation of the FIR filters in respect to /M value???/

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::491]]


**** F


** Discrete Fourier Transform (D.F.T.)
*** Intro

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::567]]

*** PROJ [#A] Periodic convolution

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::574]]

*** PROJ [#A] Linear convolution using D.F.T.

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal::602]]


** Computation of D.F.T.

*** Intro
- The D.F.T. has important role in Discrete Time signal-processing. Also there are efficient algorithms for programming (python, C++..).  They are called FFT algorithms (Fast Fourier Transform) but they are calculating all /N values of the D.F.T./. If only a portion of the frequencies are needed (0 <= ω <= 2π) other algorithms could be more efficient.
[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::602]]


** D.F.T. analysis of signals

*** Intro
- For a finite-length signals the D.F.T. provides frequency-domain samples of the discrete-time Fourier transform, and the implications of this sampling must be clearly understood.
***** Example
- In linear filtering or convolution implemented by multiplying D.F.T.s rather than discrete-time Fourier transforms,a circular convolution is implemented and special care **must** be taken to ensure that the results will be equivalent to a linear convolution.

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::719]]

*** Windowing effect
- The purpose of the window in the time-dependent Fourier transform is to limit the extend of the sequence to be transformed so the spectral characteristics are reasonably stationary over the duration of the window.

  /**The more rapidly the signal characteristics change, the shorter the window should be**/

[[file:~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::743]]

*** Sampling in Time and Frequency

* Laboratory case study

** General idea and method
*** Intro
In the present case study the aim is to find a way to filter Electromagnetic Interference at 10-20 kHz via digital signal processing (Digital Signal Processing). The reason for choosing a post-process filtering is the ability to create a system agnostic processing that could be implemented across platforms and construction standards. The main goal is to remove those frequencies and find a best way for filtering this particular type of distortion.

As examined with raising the sampling frequency a curtain amount of noise is imported with distinguishable distortion of the original signal. This could be avoided by reduction of the sampling frequency, but this will introduce Aliasing effect. This was observed when a last recording of the signal with the wind tunnel and were appearing to be less affected than the compressed air measurements. #NOTE Add to the description the reason for

*** UNIV Laboratory setup and measurement tools
**** Setup
  The idea is to measure Wind speed produced from a large fan inlet inside contained environment to control the direction. After that a wide-angle and a matrix like (setting chamber) different users are used for the even distribution of air flow. At the last section there is a contraction section for regulating the area of the test section. This is due to construction size and lab space. ??????????


A [[file:~/Pictures/Wind_Tunnel_setup_lab.png][diagram]]

**** Equipment

***** Wind sensor
The measurements used in this case study were taken from a differential pressure transducer with the details bellow
#+properties: Device details
:MODEL: Delta Ohm HD-408T
:WORK_PRINCIPLE: Differential pressure transducer
:RANGE: 0-10 m-bar
:RESISTANCE: 330 Ω
+ This device is connected with a NI USB-6353 (with optocouplers and max. rate 1.5 MS/s).


***** Data collection and analysis

****** Signal Process

The post-process is implemented with basic Digital Signal Processing python libraries and there was also developed a custom library for ease of analysis of curtain datatype files such as (.h5, .tdms) and signal processing.

- Filtering method
  + Infinite Impulse Response
    Those types are more likely to consume more processing power and RAM usage but are really really fast and reliable. They introduce some delay if applied but if the phase shift is not a big deal for the data i.e. some generally stable dc measurement but with frequency fluctuations and the signal will be studied in frequency domain. That example is not the case when the signal measured is A.C..
  + FIR
    This method is fundamentally different in respect to Infinite Impulse Response but the ability to manage large datasets with accuracy although is present it is not optimized and takes a lot of time. In opposition the frequency response is very good for EMI due to easy delay elimination with a simple equation.
    [[~/Documents/dissertation/org-docs/dissertation document/books/discrete_domain_signal.pdf::468]]
  + MEDIAN

- Filter type
  + Butterworth
  + Bessel
  + Chebby_shev
  + Elliptic
****** Recording software

The data are collected with Lab View as a recording program. Here need more info from Papadaki......

Here the signal is transferred via Telecommunication cable for minimizing the system file.

#+begin_src org lang:gr :results: raw drawer
Εδώ η ιδέα είναι να εξηγηθεί λίγο η επεξεργασία που γίνεται από το LabView για λόγους αναφοράς.
#+end_src

***** Other measuring devices
